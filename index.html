<html>
<head>
<script src = "j.js"></script>
<script src = "json.js"></script>
<script>
function is_symbol(str) {
    //return "abcdefghijklmnopqrstuvwxyz".indexOf(str) != -1;
    //return str != ")" && str != " " && str != "(" && str != '"' && str != "'" ;
    return "( )'\"\u000a".indexOf(str) == -1;
}
function is_space(chr) {
    return "\n\r\t\u000a ".indexOf(chr) != -1
}
function o(level, label, obj){
    return;
    $('body').append($("<div style = 'margin-left: "
        + (10 * level)+ "px; border: 1px solid navy;'>"
        +label+": " + $.toJSON(obj) + "</div>"))
}
function line(level, color) {
    return;
    $('body').append("<div style = 'border-bottom: 4px solid "+color+"; margin-top: 5px; margin-bottom: 8px; margin-left: "+(10 * level)+";'>")
}
$(document).ready(function(){
    var code = parse($('po').html());
    $('body').append($.toJSON(code))
    ev(code)
})
function print_out(state, exp, val, chr, level) {
    o(level, "symbol", state); o(level, "exp", exp)
    o(level, "var", val); o(level, "chr", chr)
    line(level,'red')
}

function ev(code) {
    var scope = {
        'call' : function(args){
            
        }
    
    }
    for (var i = 0; i < code.length; i++) {
        
    }
    //(a-str call deff set if lookup a o)
    
    
}

function parse(str){
    var arr = str.split('')
    var i = 0
    return parse2(arr, "symbol", [], [], arr[i], 0)
    function parse2(arr,state, exp,val,chr, level) {
        print_out(state, exp, val, chr, level)
        if (state == "symbol") {
            if (is_symbol(chr)) {
                val.push(chr)
            } else if (is_space(chr)) {  //shaping youth
                if (val.length > 0) {
                    exp.push(val.join(''))
                    val = []
                }
            } else if (chr == "(") {
                i++
                if (exp.length > 0) {
                    exp.push(parse2(arr, "symbol", [], [], arr[i], level + 1))
                } else {
                    exp.push(parse2(arr, "symbol", [], [], arr[i], level + 1))
                    //return parse2(arr, "symbol",  [], [], arr[i], level + 1)
                }
            } else if (chr == ")") {
                if (val.length > 0) {
                    val = val.join('')
                    exp.push(val)
                    val = [];
                }
                print_out(state, exp, val, chr, level)
                return exp
                
            } else if (chr == '"') {
                val.push("'")
                state = "quote"
            } 
        } else if (state == "quote") {
            if (chr == '"') {
                exp.push(val.join(''))
                val = []
                state = "symbol"
            } else if (chr == "\\"){
                state = "quote-escape"
            } else {
                val.push(chr)
            }
        } else if (state == "quote-escape") {
            if (chr == '"') {
                val.push('"');
            } else if (chr == '\\') {
                val.push("\\")
            } else {
                val.push("\\")
                val.push(chr)
            }
            state = "quote"
        }
        i++
        if (i == arr.length) {
             if (val.length > 0) {
                val = val.join('')
                exp.push(val)
                val = [];
            }
            print_out(state, exp, val, chr, level)
            line(level, 'green')
            return exp
        }
        return parse2(arr,state, exp,val,arr[i], level)
    }
}
</script>
</head>
<body>
    <po>
    (def (test a b c)
        (print a)
        (print b)
        (print (+ b c))
    )
    (test 1 3 6)
    </po>
</body>
</html>